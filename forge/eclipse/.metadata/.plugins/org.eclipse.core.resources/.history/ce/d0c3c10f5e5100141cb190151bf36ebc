package com.parmandorc.LearningMobs;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;

import com.parmandorc.LearningMobs.Fighter.EntityLMFighter;

import net.minecraft.util.ResourceLocation;
import net.minecraftforge.event.world.WorldEvent;
import cpw.mods.fml.common.eventhandler.SubscribeEvent;
import cpw.mods.fml.server.FMLServerHandler;

public class QValuesSavingHandler 
{
	@SubscribeEvent
	public void onWorldUnload(WorldEvent.Unload event)
	{
		saveQValues();
	}
	
	@SubscribeEvent
	public void onWorldSave(WorldEvent.Save event)
	{
		saveQValues();
	}
	
	private static void saveQValues()
	{
		System.out.println("Saving Q_Values to files.");
		
	    File dir = new File("./saves/learningmobsmod/qvaluesfiles");
	    dir.mkdirs();
	    if (!dir.exists())
	    	return;
	    
    	System.out.println("Saves directory created / exists.");

	    if (EntityLMFighter.Q_values != null)
	    {
			try {
		    	File file = new File(dir.getPath()+"/LMFighter.ser");
				file.createNewFile();
				FileOutputStream fos = new FileOutputStream(file.getPath());
			    ObjectOutputStream oos = new ObjectOutputStream(fos);
			    oos.writeObject(EntityLMFighter.Q_values);
			    oos.close();
			    fos.close();
			    System.out.println("LMFighter Q-values saved.");
			} catch (IOException e) {
				e.printStackTrace();
			}
	    }
	}
}
